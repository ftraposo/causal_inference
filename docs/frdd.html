<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Causal Inference - 8&nbsp; Fuzzy Regression Discontinuity</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./summary.html" rel="next">
<link href="./rdd.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./frdd.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fuzzy Regression Discontinuity</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Causal Inference</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Potential Outcomes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Matching</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Instrumental Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Difference-in-difference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./panel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Panel Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regression Discontinuity Design</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./frdd.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fuzzy Regression Discontinuity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data"><span class="header-section-number">8.0.1</span> Data</a></li>
  <li><a href="#recap" id="toc-recap" class="nav-link" data-scroll-target="#recap"><span class="header-section-number">9</span> Recap</a>
  <ul class="collapse">
  <li><a href="#sharp-rdd" id="toc-sharp-rdd" class="nav-link" data-scroll-target="#sharp-rdd"><span class="header-section-number">9.0.1</span> Sharp RDD</a></li>
  <li><a href="#fuzzy-rdd" id="toc-fuzzy-rdd" class="nav-link" data-scroll-target="#fuzzy-rdd"><span class="header-section-number">9.0.2</span> Fuzzy RDD</a></li>
  </ul></li>
  <li><a href="#seminar-overview" id="toc-seminar-overview" class="nav-link" data-scroll-target="#seminar-overview"><span class="header-section-number">10</span> Seminar Overview</a></li>
  <li><a href="#staying-in-the-first-league-parliamentary-representation-and-the-electoral-success-of-small-parties" id="toc-staying-in-the-first-league-parliamentary-representation-and-the-electoral-success-of-small-parties" class="nav-link" data-scroll-target="#staying-in-the-first-league-parliamentary-representation-and-the-electoral-success-of-small-parties"><span class="header-section-number">11</span> Staying in the First League: Parliamentary Representation and the Electoral Success of Small Parties</a>
  <ul class="collapse">
  <li><a href="#fuzzy-rdd-parametric-estimation" id="toc-fuzzy-rdd-parametric-estimation" class="nav-link" data-scroll-target="#fuzzy-rdd-parametric-estimation"><span class="header-section-number">11.0.1</span> Fuzzy RDD: Parametric Estimation</a></li>
  <li><a href="#non-parametric-fuzzy-rdd-estimation" id="toc-non-parametric-fuzzy-rdd-estimation" class="nav-link" data-scroll-target="#non-parametric-fuzzy-rdd-estimation"><span class="header-section-number">11.0.2</span> Non-Parametric Fuzzy RDD Estimation</a></li>
  <li><a href="#sensitivity-to-bandwidth" id="toc-sensitivity-to-bandwidth" class="nav-link" data-scroll-target="#sensitivity-to-bandwidth"><span class="header-section-number">11.0.3</span> Sensitivity to Bandwidth</a></li>
  <li><a href="#falsification-tests" id="toc-falsification-tests" class="nav-link" data-scroll-target="#falsification-tests"><span class="header-section-number">11.1</span> Falsification tests:</a></li>
  <li><a href="#placebo-outcomes" id="toc-placebo-outcomes" class="nav-link" data-scroll-target="#placebo-outcomes"><span class="header-section-number">11.2</span> Placebo outcomes:</a>
  <ul class="collapse">
  <li><a href="#placebo-cut-offs" id="toc-placebo-cut-offs" class="nav-link" data-scroll-target="#placebo-cut-offs"><span class="header-section-number">11.2.1</span> Placebo cut-offs</a></li>
  <li><a href="#sorting" id="toc-sorting" class="nav-link" data-scroll-target="#sorting"><span class="header-section-number">11.2.2</span> Sorting</a></li>
  </ul></li>
  <li><a href="#balance" id="toc-balance" class="nav-link" data-scroll-target="#balance"><span class="header-section-number">11.3</span> Balance</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fuzzy Regression Discontinuity</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="data" class="level3" data-number="8.0.1">
<h3 data-number="8.0.1" class="anchored" data-anchor-id="data"><span class="header-section-number">8.0.1</span> Data</h3>
<p><br>
<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("downloadthis")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(downloadthis)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">download_link</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">link =</span> <span class="st">"https://bayreuth-politics.github.io/CI22/data/enter.csv"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_name =</span> <span class="st">"enter"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_extension =</span> <span class="st">".csv"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">button_label =</span> <span class="st">"Lab 9 Data"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">button_type =</span> <span class="st">"success"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">has_icon =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">self_contained =</span> <span class="cn">TRUE</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#download_link(</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#  link = "https://github.com/dpir-ci/CI22/raw/gh-pages/docs/lectures/lecture8.pdf",</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  output_name = "week8",</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#  output_extension = ".pdf",</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#  button_label = "Lecture Slides",</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  button_type = "default",</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  has_icon = FALSE,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#  self_contained = FALSE</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<hr>
</section>
<section id="recap" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Recap</h1>
<section id="sharp-rdd" class="level3" data-number="9.0.1">
<h3 data-number="9.0.1" class="anchored" data-anchor-id="sharp-rdd"><span class="header-section-number">9.0.1</span> Sharp RDD</h3>
<p>Last week we discussed sharp regression discontinuity designs, in which a cut-off perfectly determines the treatment status of units. In simple words: all units on one side of the cut-off are treated, while all units on the other side are not:</p>
<p><span class="math display">\[
\operatorname{Pr}\left(D_{i}=1\right)=p\left(X_{i}\right)
\]</span></p>
<p><span class="math display">\[
p\left(X_{i}\right)= \begin{cases}1 &amp; \text { if } X_{i} \geq X_{0} \\ 0 &amp; \text { if } X_{i}&lt;X_{0}\end{cases}
\]</span></p>
</section>
<section id="fuzzy-rdd" class="level3" data-number="9.0.2">
<h3 data-number="9.0.2" class="anchored" data-anchor-id="fuzzy-rdd"><span class="header-section-number">9.0.2</span> Fuzzy RDD</h3>
<p>While sharp RDDs are only a special case of regression discontinuity, RDDs are more powerful than that. <strong>Fuzzy RDDs</strong> allow us to estimate causal effects in settings where treatment assignment is not deterministic. The cut-off may not perfectly determine treatment exposure, but it creates a <em>discontinuity in the probability</em> of treatment exposure. The cut-off therefore does not perfectly predict treatment status. Still, we can use a fuzzy RDD as long as it introduces a meaningful as-if random discontinuity that we can take advantage of.</p>
<p><span class="math display">\[
\begin{aligned}
\lim _{X_{i} \uparrow X_{0}} p\left(X_{i}\right) &amp; \neq \lim _{X_{i} \downarrow X_{0}} p\left(X_{i}\right)
\end{aligned}
\]</span></p>
<p>As we learned before, we cannot simply ignore treatment uptake as it likely is not random: Other (unobserved) covariates might come into play and cause units to take up or reject treatment. In other words, <em>non-compliance</em> with treatment assignment is an issue in this case that must be taken into account in order to estimate an unbiased causal effect - this should have you recall Lab 7.</p>
<p>In fact, a <em>fuzzy RDD</em> simply incorporates an instrumental variable (IV) that is applied to a regression discontinuity. Usually we can use the treatment assignment - i.e.&nbsp;on which side a unit is of a cut-off - as an instrument for treatment status. Similarly to the IV design, we estimate the <em>LATE</em> among compliers - or <em>CACE</em> at the discontinuity. Note that all assumptions of the IV design need to be satisfied here, too. Extrapolating across the discontinuity, this allows us to estimate the <em>LATE</em> for compliers at the discontinuity (close to the threshold):</p>
<p><span class="math display">\[
\begin{aligned}
\alpha_{F R D D} &amp;=E\left[Y_{1}-Y_{0} \mid X=c  \right] \\
&amp;=\frac{\lim _{x \downarrow c} E[Y \mid X=c]-\lim _{x \uparrow c} E[Y \mid X=c]}{\lim _{x \downarrow c} E[D \mid X=c]-\lim _{x \uparrow c} E[D \mid X=c]} \\
&amp;=\frac{\text { outcome discontinuity }}{\text { treatment discontinuity }} \\
&amp; \approx \frac{E[Y \mid Z=1]-E[Y \mid Z=0]}{E[D \mid Z=1]-E[D \mid Z=0]}
\end{aligned}
\]</span></p>
<p>This again should sound familiar - the <em>LATE</em> among compliers in fuzzy RDDs can be estimated using a 2SLS regression as we will see in today’s Lab.</p>
<hr>
<p><strong>Before starting this seminar</strong></p>
<ol type="1">
<li><p>Create a folder called “lab9”</p></li>
<li><p>Download the data (you can use the button or the one at the top, or read csv files directly from github):</p></li>
<li><p>Open an R script (or Markdown file) and save it in our “lab9” folder.</p></li>
<li><p>Set your working directory using the setwd() function or by clicking on “More“. For example <em>setwd(“~/Desktop/Causal Inference/2022/Lab9”)</em></p></li>
<li><p>Let’s install an load packages that we will be using in this lab:</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rdd) <span class="co"># to conduct a density test</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rdrobust) <span class="co"># to conduct non-parametric estimation</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rddensity) <span class="co"># to conduct a density test</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># ggplot(), %&gt;%, mutate() </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)  <span class="co"># Convert models to data frames</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rdrobust)  <span class="co"># For robust nonparametric regression discontinuity</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(estimatr)  <span class="co"># Run 2SLS models in one step with iv_robust()</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)  <span class="co"># Create side-by-side regression tables</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)  <span class="co"># Fancy table formatting</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># to generate plots</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven) <span class="co"># to import dta files. </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wesanderson) <span class="co"># To change the colour scheme of ggplot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="seminar-overview" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Seminar Overview</h1>
<p>In this <strong>seminar</strong>, we will cover the following topics:<br>
1. Familiarise ourselves with the data structure of fuzzy RDD and the substantive interpretation of the estimator.<br>
2. Visualise discontinuities in terms of treatment and outcome at the cut-off.<br>
3. Estimate parametric fuzzy RDDs using 2SLS regressions.<br>
4. Using the <code>rdrobust</code> package to estimate non-parametric fuzzy RDDs.<br>
5. Conduct the following robustness/falsification tests such as balance test, placebo outcome and density test.</p>
<hr>
</section>
<section id="staying-in-the-first-league-parliamentary-representation-and-the-electoral-success-of-small-parties" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Staying in the First League: Parliamentary Representation and the Electoral Success of Small Parties</h1>
<p>To familiarize ourselves with fuzzy RDDs, we will be analysing data from the paper <a href="https://core.ac.uk/download/pdf/71804766.pdf">Staying in the First League: Parliamentary Representation and the Electoral Success of Small Parties</a> authored by Elias Dinas, Pedro Riera and Nasos Roussias.</p>
<p>In this paper, the authors seek to contribute to answering one of the most essential research questions in party politics: Why are some small parties successful whereas other whither away? What accounts for the variation in the trajectories of small parties?</p>
<p>The authors theorise an organisational mechanism that contributes to parties’ success. According to their expectations, <em>entering parliament</em> should lead to an increase in a party’s vote share in the subsequent election. This is because being represented in parliament usually comes with a lot of benefits, which are not experienced by parties that are not represented: influence on policy-making, public funding, media visibility, an increase in organisational capacity (staff, etc.) as well as reduced uncertainty about electoral viability and ideological profiles. Conversely, parties that fail to enter parliament do not gain these benefits and might even be abandoned by promising personnel. As you notice, there might be a lot of reasons which make it difficult to isolate a causal effect without an appropriate identification strategy.</p>
<p>In many multi-party systems, there is a legal threshold for representation in parliament at the national level, usually in terms of a fixed vote share, that determined whether a party enters parliament or not. The authors exploit the randomness introduced by these electoral thresholds to circumvent endogeneity problems. Clearly, parties are not able to manipulate their vote share - at least in democracies. The authors look at countries that had employed a legal threshold of representation at the national level at least one since 1945.</p>
<p><strong>Why do we need to estimate a <em>fuzzy RDD</em> here?</strong> Unlike the sharp RDD, in this case some candidates make it to parliament even though their party did not pass the threshold - in other words, there is non-compliance with treatment assignment as the discontinuity does not fully determine treatment status. Roughly 20% of electoral systems allow some parties to get into parliament even if they did not meet the threshold - can you think of reasons why?</p>
<p>The authors use a linear regression estimator with a triangular kernel and optimal bandwidths determined by Imbens/Kalyanaramn’s algorithm (h=2.4, after the cut-off is centred). The outcome is parties’ vote share at the subsequent election (<span class="math inline">\(t_1\)</span>). They find a local average treatment effect among compliers of 1.9%-points: Parties that have not cleared the threshold received 3.9 percent at election <span class="math inline">\(t_1\)</span>, whereas those who overcome the threshold get 5.8 percent. This amounts to a meaningful and substantive effect of an increase of around 40% in their vote share.</p>
<p><em>Note: Electoral thresholds vary by country, ranging from 0.67%-points to 10%-points. To make observations comparable, the authors standardise electoral results. They use 3.51 as common cut-off point and transform vote shares to that scale. Importantly, the relative distance from the threshold remains the same:</em></p>
<p><span class="math display">\[\frac{Vote Share_i}{Threshold_i} = \frac{VoteShare_{i, standardised}}{3.51} \]</span></p>
<p>We will be using the following variables:</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>performance</code></td>
<td>This is the <em>standardised and centred</em> vote share of party <em>i</em> at <span class="math inline">\(t_0\)</span>.</td>
</tr>
<tr class="even">
<td><code>treat</code></td>
<td>Binary variable that indicates whether the party’s vote share met/exceeded the threshold (=1) or not (=0).</td>
</tr>
<tr class="odd">
<td><code>newsuccess</code></td>
<td>The party’s vote share in the subsequent election at <span class="math inline">\(t_1\)</span>.</td>
</tr>
<tr class="even">
<td><code>treated</code></td>
<td>Binary variable indicating whether a party entered parliament (=1) or not (=0)</td>
</tr>
<tr class="odd">
<td><code>oldsuccess</code></td>
<td>The <em>standardised and centred</em> vote share of party <em>i</em> at <span class="math inline">\(t_{(-1)}\)</span>, which we’ll use as a placebo.</td>
</tr>
<tr class="even">
<td><code>newperc</code></td>
<td>Indicates the standardised vote share in absolute terms</td>
</tr>
<tr class="odd">
<td><code>seats</code></td>
<td>Indicates the number of seats won in an election</td>
</tr>
<tr class="even">
<td><code>established</code></td>
<td>Binary variable indicating if a country is an established democracy</td>
</tr>
<tr class="odd">
<td><code>oldparty</code></td>
<td>Count variable indicating how many elections a party had contested before.</td>
</tr>
</tbody>
</table>
<hr>
<p>Now let’s load the data. There are two ways to do this:</p>
<p>You can load the brands dataset from your laptop using the <code>read.csv()</code> function. You can call this data set <code>enter</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set your working directory</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#setwd("~/Desktop/Causal Inference/2022/Lab9")</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>enter <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://bayreuth-politics.github.io/CI22/data/enter.csv"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#head(enter)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Now, let’s see how the data looks like. Generate a plot using the <code>rdplot()</code> function from the <code>rdrobust</code> package.</p>
<p>The syntax is quite simple - see it:</p>
<p><strong>Exercise 1: Generate a plot using the <code>rdplot(Y, X, ci = 95, binselect = "", subset = condition)</code> function. Replace X with <code>enter$performance</code> and Y with <code>enter$newsuccess</code>. Set the argument <code>ci</code> equal to 95, so we can display confidence interval in each bin. Let’s create a RD plot with evenly-spaced bins by setting the argument <code>binselect</code> equal to “es”. Finally, let’s subset the data for parties whose standardised vote share was below 3.51. For this, set the argument <code>subset</code> equal to <code>performance &lt; 3.51</code>. For more details about this function please see below. </strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdplot</span>(Y, X, <span class="at">c =</span> <span class="dv">0</span>, <span class="at">ci =</span> <span class="dv">95</span>, <span class="at">binselect =</span> <span class="st">"es"</span>, <span class="at">subset =</span> Z <span class="sc">&lt;</span> condition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Function/argument</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Y</td>
<td>Y is the dependent variable.</td>
</tr>
<tr class="even">
<td>X</td>
<td>X is the running variable</td>
</tr>
<tr class="odd">
<td>c</td>
<td>To specify the cut-off the default is 0</td>
</tr>
<tr class="even">
<td>ci</td>
<td>Optional graphical option to display confidence intervals of selected level for each bin</td>
</tr>
<tr class="odd">
<td>binselect</td>
<td>Specifies the procedure to select the number of bins. See options below:</td>
</tr>
<tr class="even">
<td></td>
<td><strong>es: IMSE-optimal evenly-spaced method using spacings estimators.</strong></td>
</tr>
<tr class="odd">
<td></td>
<td>esmv: mimicking variance evenly-spaced method using spacings estimators. This is the default option.</td>
</tr>
<tr class="even">
<td></td>
<td>qspr: IMSE-optimal quantile-spaced method using polynomial regression.</td>
</tr>
<tr class="odd">
<td>subset</td>
<td>an optional vector specifying a subset of observations to be used.</td>
</tr>
</tbody>
</table>
<p><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdplot</span>(enter<span class="sc">$</span>newsuccess, enter<span class="sc">$</span>performance, <span class="at">ci=</span><span class="dv">95</span>, <span class="at">binselect=</span><span class="st">"es"</span>, <span class="at">subset =</span> enter<span class="sc">$</span>performance <span class="sc">&lt;</span><span class="fl">3.51</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that it might make sense to look at the discontinuity in terms of the treatment, too. This will give us a (visual) indication of whether the discontinuity in terms of treatment status is meaningful. You can simply use the <code>rdplot</code> command to do this.<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdplot</span>(enter<span class="sc">$</span>treated, enter<span class="sc">$</span>performance, <span class="at">ci=</span><span class="dv">95</span>, <span class="at">binselect=</span><span class="st">"es"</span>, <span class="at">subset =</span> enter<span class="sc">$</span>performance <span class="sc">&lt;</span><span class="fl">3.51</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As expected, we have perfect compliance above the threshold - and rather strong yet imperfect compliance below the threshold.</p>
</details>
<p><br>
</p>
<p>Note that we use 3.51 to drop observations larger than that number (weighted threshold). This insures a balanced N below and above the cut-off. While the running variable is standardised, it cannot take on values smaller than 0 (which would correspond to a 0% vote share). To account for this, we mirror this natural boundary above the threshold.</p>
<p>Let’s check that this indeed a fuzzy design. To do so let’s first create a new variable called <code>treatment_received</code>.</p>
<p><strong>Exercise 2: Create a new variable that is equal to “Treated” if the <code>treated</code> variable is equal to 1, and “Not treated” otherwise. You can use the <code>mutate()</code> and <code>ifelse()</code> function to do this. You can see an example below.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_variable =</span> <span class="fu">ifelse</span>(variable <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Treated"</span>, <span class="st">"Not treated"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>enter <span class="ot">&lt;-</span> enter <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">treatment_received =</span> <span class="fu">ifelse</span>(treated <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Treated"</span>, <span class="st">"Not treated"</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(enter<span class="sc">$</span>treatment_received)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br>
</p>
<p>Now that we have created this variable, let’s use it to generate other RD plots that will help us identify whether the units actually received the treatment condition that they were assigned to. Let’s use ggplot this time.<br>
</p>
<p><strong>Exercise 3: Generate the following plot:</strong></p>
<ul>
<li><p>Map data components into the graph <code>ggplot(aes(x = running variable, y = outcome, colour = as.factor(new received variable)), subset(subset=running variable &lt;3.51), data = data)</code></p></li>
<li><p>Add a scatter plot by adding the following function: <code>geom_point(size = , alpha = )</code>. Set the <code>size</code> argument equal to 1 and the <code>alpha</code> argument equal to 0.6.</p></li>
<li><p>Add a linear regression below the threshold using: <code>geom_smooth(data = filter(subset(data,subset=running variable &lt;3.51), running variable &lt;= 0), method = "lm")</code></p></li>
<li><p>Add a linear regression above the threshold using: <code>geom_smooth(data = filter(subset(data,subset=running variable &lt;3.51), running variable &gt; 0), method = "lm")</code></p></li>
<li><p>Add vertical that pass through 0 on the vertical axis by setting the <code>intercept</code> equal to 0: <code>geom_vline(xintercept = 0)</code></p></li>
<li><p>Change the labels on the y and x axis using: <code>labs(x = "Vote share t0", y = "Vote share t1", color = "Treated")</code></p></li>
<li><p>Change the default colours adding the Wes Anderson palette: <code>scale_color_manual(values=wes_palette("Darjeeling1"))</code></p></li>
</ul>
<p><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(enter, <span class="at">subset=</span>performance<span class="sc">&lt;</span><span class="fl">3.51</span>), <span class="fu">aes</span>(<span class="at">x =</span> performance, <span class="at">y =</span> newsuccess, <span class="at">color =</span> <span class="fu">as.factor</span>(treatment_received))) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make points small and semi-transparent since there are lots of them</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  Add a line based on a linear model for the parties meeting the threshold</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="fu">filter</span>(<span class="fu">subset</span>(enter,<span class="at">subset=</span>performance <span class="sc">&lt;</span><span class="fl">3.51</span>), performance <span class="sc">&lt;=</span> <span class="dv">0</span>), <span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a line based on a linear model for the parties missing the threshold</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="fu">filter</span>(<span class="fu">subset</span>(enter,<span class="at">subset=</span>performance <span class="sc">&lt;</span><span class="fl">3.51</span>), performance <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add labels</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Vote share t0"</span>, <span class="at">y =</span> <span class="st">"Vote share t1"</span>, <span class="at">color =</span> <span class="st">"Treated"</span>) <span class="sc">+</span>          <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">wes_palette</span>(<span class="st">"Darjeeling1"</span>)) <span class="co"># change the defaults palette. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
From a quick visual inspection, we can see that we are dealing with a case of one-sided non-compliance. This means that some parties that were below the threshold entered parliament nonetheless - this is what we would expect. Conversely, every party that met its respective threshold entered parliament - as it should be.</p>
</details>
<p><br>
</p>
<p>Let’s now calculate the proportion of compliers above and below the threshold, just to know more about the extent of non-compliance we are dealing with.</p>
<p><strong>Exercise 4: Calculate the proportion of compliers above and below the threshold. Use the instructions and functions below to do this.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span>  </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable1, variable2) <span class="sc">%&gt;%</span>  <span class="co"># </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable1) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop  =</span> count<span class="sc">/</span> <span class="fu">sum</span>(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Group observations by using the <code>group_by()</code> function and include the following variables: <code>treated</code> and <code>performance&lt;=0</code>. By executing this operation, we are is creating four groups: 1) Parties elected/above the threshold; 2) Parties elected/below the threshold; 3) Non elected parties/above the threshold; 4) Non elected parties/below the threshold.</p></li>
<li><p>Add the <code>summarise()</code> function and create a new data frame from the grouping data frame we created before. Add <code>count</code> inside of the summarise function. This will be a variable that will store the number of observations in each group. For this, we need to add the <code>n()</code> function that calculates the number of observations in each group. By adding the two functions below, we get the number of observations in each of the four groups (feel free to run just these two lines and see what you get).</p></li>
<li><p>Finally, let’s calculate the <em>proportion</em> of compliers above and below the threshold. We can do this by grouping observations by their treatment condition and then using the <code>sum()</code> function. We can create a new variable called <code>prop</code>. It is based on the number of observations in each sub-group (whether they were above or below the threshold). Then, we divide this number by the total number of observations within each treatment condition using the <code>sum(count)</code> function. This will give you the proportion of compliance.</p></li>
</ul>
<p>More detail of these function can be found below:</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Function/argument</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>group_by()</td>
<td>Groups observations by the variables included in the function</td>
</tr>
<tr class="even">
<td>summarise()</td>
<td>Creates a new data frame. It will have one (or more) rows for each combination of grouping variables</td>
</tr>
<tr class="odd">
<td>n()</td>
<td>returns the number of observations in a current group</td>
</tr>
<tr class="even">
<td>sum()</td>
<td>returns the sum of all the values present in its arguments</td>
</tr>
</tbody>
</table>
<p><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>enter <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treated, performance <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treated) <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop  =</span> count<span class="sc">/</span> <span class="fu">sum</span>(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see the count and proportion of compliance in each group. We see that 176 times parties were below the threshold, but end up in parliament (around <code>10\%</code> of the observations). We can confirm that we have a case of one-sided non-compliance.</p>
</details>
<p><br>
</p>
<hr>
<p>Let’s subset the data for the following analyses. We want to make sure we have a fair comparison between observations below and above the cut-off. Since the <code>performance</code> variable cannot have outcomes <code>&lt;-3,51</code>, we mirror the data by subsetting positive performance scores:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>enter<span class="ot">=</span>enter[enter<span class="sc">$</span>performance<span class="sc">&lt;</span><span class="fl">3.51</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<section id="fuzzy-rdd-parametric-estimation" class="level3" data-number="11.0.1">
<h3 data-number="11.0.1" class="anchored" data-anchor-id="fuzzy-rdd-parametric-estimation"><span class="header-section-number">11.0.1</span> Fuzzy RDD: Parametric Estimation</h3>
<p>As last week, let’s estimate a parametric fuzzy RDD first to make sure we understand the underlying logic - which is based on the instrumental variables design. Remember that in the case of <em>fuzzy RDDs</em> we have ‘two events’ of interest. First, <strong>‘treatment assignment’</strong> which is defined by the running variable exceeding the cut-off, and, secondly, actual <strong>treatment status</strong>. Let formally state that <span class="math inline">\(Z_i\)</span> is an indicator for when <span class="math inline">\(X_{i,\text{centered}}\)</span> exceeds the cut-off. We can then use this variable to instrument for the endogenous treatment variable <span class="math inline">\(D_{i}\)</span>.<br>
</p>
<p>The principle is the same as in the IV design: We have an instrument, <span class="math inline">\(Z_i\)</span>, that describes assignment to treatment based on an observation’s position relative to the cut-off. We know that the instrument is a strong predictor - as it should be - of the treatment status, <span class="math inline">\(D_i\)</span>. We can therefore exploit the random variation (close to the cut-off) introduced by the instrument to predict treatment status in our <em>first stage</em> - which you can think of as indicating compliance with the treatment assignment or describing the discontinuity in the probability of receiving treatment:</p>
<p><span class="math display">\[\hat{D_i} = \gamma_0 + \gamma_1 X_{i,centered} + \gamma_2 Z_i + \rho_i\]</span> for <span class="math display">\[c-h \leq X_i \leq c + h\]</span></p>
<p>Here, in a simple linear model with a single slope <span class="math inline">\(\hat{D}\)</span> predicts the treatment status based on assignment to the treatment, (<span class="math inline">\(Z_i\)</span>), and the vote share (<span class="math inline">\(X_{i,centered}\)</span>) in <span class="math inline">\(t_0\)</span>.</p>
<p>The second stage, then, uses the predicted values to calculate the following equation in order to estimate the LATE among compliers at the cut-off:</p>
<p><span class="math display">\[\hat{Y_i} = \beta_0 + \beta_1 X_{i,centered} + \beta_2 \hat{D_i} + \epsilon_i\]</span> for <span class="math display">\[c-h \leq X_i \leq c + h\]</span></p>
<p>Our coefficient of interest is <span class="math inline">\(\beta_2\)</span>, which is the Local Average Treatment Effect (‘LATE’) among compliers at the cut-off. Having this in mind, we know we can estimate a parametric fuzzy RDD by specifying a 2SLS regression. This can be done using the packages and commands you already know, such as <code>iv_robust()</code>.<br>
</p>
<p><strong>Exercise 5: Estimate a parametric fuzzy RDD model using the <code>iv_robust()</code> command. Interpret your findings. </strong><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model_fuzzy <span class="ot">&lt;-</span> <span class="fu">iv_robust</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  newsuccess <span class="sc">~</span> treated <span class="sc">+</span> performance <span class="sc">|</span> treat <span class="sc">+</span> performance,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">filter</span>(enter)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_fuzzy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Specifying the 2SLS model, we find that the estimated effect is <code>1.65%-points</code> on the <em>standardised scale</em>. The estimate is also statistically significant, so we conclude that the estimated LATE among compliers is meaningfully different from <code>0</code>.<br>
</p>
Is this estimate robust though? The global parametric estimation has significant weaknesses. Think of our identification assumption for the RDD. In this global model, we have been using <em>all</em> observations from the data frame, including those rather far away from the threshold - i.e.&nbsp;those which are not really comparable. Moreover, the parametric model, unlike kernel estimators, does not weigh observations. Accordingly, the bias introduced by including the whole range of data is possibly severe. We might have estimated a biased effect here.
</details>
<p><br>
</p>
<p>Let’s tackle this problem by estimating a more credible parametric fuzzy RDD. We can do so by subsetting the data we input into the regression model.</p>
<p><strong>Exercise 6: Estimate the same model as above, but only consider parties with vote shares up to <code>1%</code> on the standardised scale below/above the threshold. Is this result more credible? </strong><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model_fuzzy_range <span class="ot">&lt;-</span> <span class="fu">iv_robust</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  newsuccess <span class="sc">~</span> treated <span class="sc">+</span> performance <span class="sc">|</span> treat <span class="sc">+</span> performance,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">filter</span>(enter, performance <span class="sc">&lt;=</span> <span class="dv">1</span>, performance<span class="sc">&gt;-</span><span class="dv">1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_fuzzy_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
</p>
<p>This estimator draws a different picture. Our estimated effect is now <code>2.93%-points</code> on the standardised scale - this is meaningful and almost as large in magnitude as the standardised threshold itself. The estimate is also statistically significant. Based on this model specification, we can conclude that the LATE among compliers at the cut-off indeed is meaningful.<br>
</p>
<p>This model is somewhat more credible than the one we estimated above. Now we are only looking at observations which represent parties with a vote share of up to <code>1%-point</code> above or below the standardised threshold. This is more reasonable as as these parties should be more comparable. In fact, we find that wihtin this range the actual vote share (<code>performance</code>) does not predict the result of the subsequent election in any meaningful way. Within this rather small window, entering parliament drives variation in the subsequent election.<br>
</p>
<p>Note that the model still has some disadvantages: We specify the functional form of the model and still do not weigh observations based on their distance to the cut-off. Estimating non-parametric models helps us calculate even more robust estimates.</p>
</details>
<p><br>
</p>
<hr>
</section>
<section id="non-parametric-fuzzy-rdd-estimation" class="level3" data-number="11.0.2">
<h3 data-number="11.0.2" class="anchored" data-anchor-id="non-parametric-fuzzy-rdd-estimation"><span class="header-section-number">11.0.2</span> Non-Parametric Fuzzy RDD Estimation</h3>
<p>In a first step, let’s ‘emulate’ the parametric model we just specified - this time estimating a non-parametric model.<br>
</p>
<p>Fuzzy estimation with <code>rdrobust</code> is - thankfully - relatively straightforward. The syntax is essentially the same as in the case of sharp RDDs, obviously with the exception that we need to specify that our model is supposed to estimate a fuzzy RDD. We can do so using the <code>fuzzy=</code> argument to specify the treatment status (<code>treated</code> in our case). Importantly, you do not need to specify an instrument (or even create one!). All you need to specify is the column that indicates treatment status, the running variable and the cut-off — <code>rdrobust</code> will do all the above/below-the-cut-off instrument stuff behind the scenes for you.</p>
<p><strong>Exercise 7: Estimate a non-parametric fuzzy RDD with a bandwidth of <code>h=1</code> and uniform kernel. </strong><br>
</p>
<p>The syntax of <code>rdrobust</code> is pretty similar to the sharp RDD. Recall that the argument <code>c</code> specifies the cut-off, while <code>h</code> determines the bandwidth. The <code>fuzzy</code> argument is sufficient to have <code>rdrobust</code> estimate a fuzzy model.<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rdrobust</span>(outcome, running_var, <span class="at">c=</span>, <span class="at">fuzzy=</span>treatment_status,   <span class="at">h=</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rdrobust</span>(enter<span class="sc">$</span>newsuccess, enter<span class="sc">$</span>performance, <span class="at">c=</span><span class="dv">0</span>, <span class="at">fuzzy=</span>enter<span class="sc">$</span>treated,  <span class="at">kernel=</span><span class="st">"uniform"</span>, <span class="at">h=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
</p>
<p>How does that look like? The estimated effect is pretty similar to the one from our (narrow) parametric estimation. Conventional measures of uncertainty also indicate that the effect is significant - looking at the robust p-values and confidence intervals, however, reveals that we would <em>not</em> reject the null hypothesis based on the robust estimation - which we should base our conclusion on. Here, we find that there is no significant LATE among compliers.</p>
</details>
<p><br>
</p>
<p>As we know, <code>rdrobust</code>allows us to specify more appropriate models to estimate our treatment effect. Let’s now make use of these opportunities to run more precise models.<br>
</p>
<p><strong>Exercise 8: Estimate the treatment effect, specifying a triangular kernel and a MSE-optimal bandwidth. Also, cluster standard errors by country using the <code>cluster=</code> argument. </strong><br>
</p>
<p><em>Note: You can simply add the <code>cluster</code> argument and enter the relevant cluster variable. Recall that optimal bandwidths are specified using the <code>bwselect</code> argument instead of <code>h</code>.</em></p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rdrobust</span>(enter<span class="sc">$</span>newsuccess, enter<span class="sc">$</span>performance, <span class="at">c=</span><span class="dv">0</span>, <span class="at">fuzzy=</span>enter<span class="sc">$</span>treated,  <span class="at">kernel=</span><span class="st">"triangular"</span>, <span class="at">cluster=</span>enter<span class="sc">$</span>countrycode, <span class="at">bwselect=</span><span class="st">"mserd"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
</p>
<p>We see that the MSE-optimal bandwidth corresponds to <code>1.13%-points</code> on the standardised scale on either side of the cut-off.<br>
</p>
<p>The estimated LATE among compliers is <code>1.86</code>, not that different from our previous point estimates. Under this model specification, we find that the estimated effect is not statistically significant - the robust confidence interval includes zero, so we cannot conclude that there indeed is a significant effect of entering parliament on parties’ vote share in the subsequent election.<br>
</p>
<p>Note that this model uses a triangular kernel and accounts for non-independence among observations in the same country - for which reason it is somehwat more convincing compared to the models we estimated before.</p>
</details>
<p><br>
</p>
<p>We can also include covariates. The <code>rdrobust</code> package is very flexible in this regard and makes it easy to adjust for them. You can simply add the argument <code>covs=</code> and specify the variables you want the model to include.<br>
</p>
<p><strong>Exercise 9: Specify a non-parametric fuzzy RDD with MSE-optimal bandwidth, clustered standard errors and <code>seats</code> and <code>newperc</code> as covariates. Interpret your result. </strong><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rdrobust</span>(enter<span class="sc">$</span>newsuccess, enter<span class="sc">$</span>performance, <span class="at">c=</span><span class="dv">0</span>, <span class="at">fuzzy=</span>enter<span class="sc">$</span>treated,  <span class="at">kernel=</span><span class="st">"triangular"</span>, <span class="at">cluster=</span>enter<span class="sc">$</span>countrycode, <span class="at">covs=</span> enter<span class="sc">$</span>seats <span class="sc">+</span> enter<span class="sc">$</span>newperc,  <span class="at">bwselect=</span><span class="st">"mserd"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
This again looks interesting - the optimal bandwidth hasn’t changed much, nor did the magnitude of the estimated treatment effect. Similarly to the model we estimated in the exercise before, however, the treatment effect is not statistically significant to robust estimations.<br>

</details>
<p><br>
</p>
<hr>
</section>
<section id="sensitivity-to-bandwidth" class="level3" data-number="11.0.3">
<h3 data-number="11.0.3" class="anchored" data-anchor-id="sensitivity-to-bandwidth"><span class="header-section-number">11.0.3</span> Sensitivity to Bandwidth</h3>
<p>Can we be sure our estimated effect is robust to changing the bandwidth? Let’s see if the estimated effect varies meaningfully. As last week, let’s plot the effect over changing bandwidths.</p>
<p><strong>Exercise 10: Plot the estimated effect and 95% confidence intervals for the model specification from the previous exercise over bandwidths ranging from <code>0.1</code> to <code>3.5</code> in <code>0.1%-points</code> intervals. </strong><br>
</p>
<p><em>Note: You migth want to use the following approach</em></p>
<ul>
<li><p><em>Create a data frame with all variables you need for the plot and a and observation for each bandwidth.</em></p></li>
<li><p><em>Extract the values from the rdrobust output which you need for your plot.</em></p></li>
<li><p><em>Loop the regression and the extraction of output over the bandwidths indicated in the initial data frame.</em></p></li>
<li><p><em>Save the output in your loop to the respective row in the data frame.</em></p></li>
<li><p><em>Plot the output from the newly created data frame.</em></p></li>
</ul>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>bandwidth <span class="ot">&lt;-</span>  <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">3.5</span>, <span class="at">by =</span> <span class="fl">0.1</span>)  <span class="co">#create a vector with values for each bandwidth you want to estimate</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>coefficient<span class="ot">&lt;-</span> <span class="cn">NA</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>ci_u <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>ci_l <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>data_extract <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(bandwidth, coefficient, se, obs, bw, ci_u, ci_l) <span class="co"># create a data.frame with all variables you want to include in your data set</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># create a loop for each bandwidth that is indicated by 'i'</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> bandwidth){</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  rdbw <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(enter<span class="sc">$</span>newsuccess, enter<span class="sc">$</span>performance, <span class="at">c=</span><span class="dv">0</span>, <span class="at">fuzzy=</span>enter<span class="sc">$</span>treated,  <span class="at">kernel=</span><span class="st">"triangular"</span>, <span class="at">cluster=</span>enter<span class="sc">$</span>countrycode, <span class="at">covs=</span> enter<span class="sc">$</span>seats <span class="sc">+</span> enter<span class="sc">$</span>newperc, <span class="at">h=</span>i) <span class="co"># run the model</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the model output (make sure to extract *robust* statistics)</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  data_extract<span class="sc">$</span>coefficient[data_extract<span class="sc">$</span>bandwidth<span class="sc">==</span>i]  <span class="ot">&lt;-</span> rdbw<span class="sc">$</span>coef[<span class="dv">3</span>] </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  data_extract<span class="sc">$</span>se[data_extract<span class="sc">$</span>bandwidth<span class="sc">==</span>i]  <span class="ot">&lt;-</span> rdbw<span class="sc">$</span>se[<span class="dv">3</span>]</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  data_extract<span class="sc">$</span>obs[data_extract<span class="sc">$</span>bandwidth<span class="sc">==</span>i]  <span class="ot">&lt;-</span> (rdbw<span class="sc">$</span>N_h[<span class="dv">1</span>] <span class="sc">+</span> rdbw<span class="sc">$</span>N_h[<span class="dv">2</span>]) </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  data_extract<span class="sc">$</span>bw[data_extract<span class="sc">$</span>bandwidth<span class="sc">==</span>i]  <span class="ot">&lt;-</span> (rdbw<span class="sc">$</span>bws[<span class="dv">1</span>, <span class="dv">1</span>]) </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  data_extract<span class="sc">$</span>ci_l[data_extract<span class="sc">$</span>bandwidth<span class="sc">==</span>i]  <span class="ot">&lt;-</span> rdbw<span class="sc">$</span>ci[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  data_extract<span class="sc">$</span>ci_u[data_extract<span class="sc">$</span>bandwidth<span class="sc">==</span>i]  <span class="ot">&lt;-</span> rdbw<span class="sc">$</span>ci[<span class="dv">3</span>,<span class="dv">2</span>]</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure the coefficient (and all other values) are numeric</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>data_extract<span class="sc">$</span>coefficient  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data_extract<span class="sc">$</span>coefficient)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the estimates across bandwidths</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_extract,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> bandwidth, <span class="at">y =</span> coefficient)) <span class="sc">+</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci_l, <span class="at">ymax =</span> ci_u), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">7.5</span>, <span class="fl">7.5</span>)) <span class="sc">+</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"LATE among Compliers at Discontinuity"</span>, <span class="at">x =</span> <span class="st">"Bandwidths (Vote Margin)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
</p>
<p>This looks interesting - the estimate varies vastly for very narrow bandwidths, but this is expected given the small number of observations that are close around the threshold. This is not uncommon to see. However, it even looks like there is almost a significant <em>negative</em> treatment effect for bandwidths around <code>0.5%-points</code>. Our estimated <em>positive</em> treatment effect is robust to all bandwidths starting from around <code>2.6%</code> the end of the range. We can be confident that the effect is not contingent on specific bandwidths. What do we conclude?</p>
</details>
<p><br>
</p>
<p>Are we reasonably confident that there is a significant effect of entering parliament at <span class="math inline">\(t_0\)</span> on a party’s vote share in the subsequent election (<span class="math inline">\(t_1\)</span>)? What would be the effect in substantive terms though?<br>
</p>
<p>We know that the threshold (and parties’ vote shares) have been standardised, with the standardised threshold being at <code>3.51%-points</code>. We can now write a function to convert the standardised (or synthetic) scale into substantive vote shares based on a country’s electoral threshold:<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>standardised_to_vote <span class="ot">&lt;-</span> <span class="cf">function</span>(coef, threshold) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  vote_share <span class="ot">&lt;-</span> coef<span class="sc">*</span>threshold<span class="sc">/</span><span class="fl">3.51</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vote_share)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Exercise 11: Based on the treatment effect from our previous model from Exercise 9 (<code>2.057</code>), calculate the substantive treatment effect in Turkey, Greece and a country of your choice. For this exercise, let’s forget that the estimated effect was not statistically significant - we just want to get an impression of its magnitude. </strong><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In Turkey, the threshold is 10%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">standardised_to_vote</span>(<span class="fl">2.057</span>, <span class="dv">10</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># In Greece, there's only a 3% threshold </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">standardised_to_vote</span>(<span class="fl">2.057</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recall that standardisation means that we are estimating the effect relative to the threshold. Accordingly, we will get different substantive results for countries with different absolute thresholds. The substantive effect will be roughly <span class="math inline">\(\frac{6}{10}\)</span> of the size of the threshold (because <code>2.057</code>/<code>3.51</code> <span class="math inline">\(\approx\)</span> 0.6).<br>
</p>
<p>We find that the substantive gain of entering parliament in Turkey corresponds to an increase of <code>5.86%-points</code> in the subsequent election, whereas it amounts to <code>1.76%-points</code> in Greece. What about the other country you chose?</p>
</details>
<p><br>
</p>
<hr>
</section>
<section id="falsification-tests" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="falsification-tests"><span class="header-section-number">11.1</span> Falsification tests:</h2>
</section>
<section id="placebo-outcomes" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="placebo-outcomes"><span class="header-section-number">11.2</span> Placebo outcomes:</h2>
<p>We can conduct multiple tests to find evidence that there is no manipulation of the score around the cut-off. If units cannot precisely manipulate their scores, therefore we should expect no differences in terms of covariates for units above and below the threshold (we will test this later). We should also expect that there should not be differences in outcomes that should not be affected by the treatment. These outcomes are sometimes called ‘pseudo-outcome’ in the RDD literature.</p>
<p>One pseudo-outcome that we can use in this study is electoral success (standardised vote share) in the previous election (<span class="math inline">\(t_{-1}\)</span>). The idea here is that current parliamentary representation in period (<span class="math inline">\(t_0\)</span>) would not affect electoral performance in <span class="math inline">\(t_{-1}\)</span>. Let’s see if this is true.</p>
<p><strong>Exercise 12: Conduct a placebo outcome test using the placebo outcome variable <code>oldsuccess</code>. Use the <code>rdrobust()</code> function to perform this test. Set the argument <code>bwselect</code> equal to “mserd”. Set the cut-off argument <code>c</code> equal to zero. Use the <code>summary()</code> command to report the results. What can you conclude based on this test? Does the evidence support the continuity assumption?</strong></p>
<p><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rdrobust</span>(enter<span class="sc">$</span>oldsuccess, enter<span class="sc">$</span>performance, <span class="at">c=</span><span class="dv">0</span>, <span class="at">bwselect=</span><span class="st">"mserd"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We find that the local regression estimate is <code>-1.713</code> and the robust confidence interval goes from <code>-5.158</code> to <code>2.153</code> (and the p-value is <code>0.420</code>). We find that there no is evidence of manipulation of the running variable around the cut-off with respect ot previous electoral results.</p>
</details>
<p><br>
</p>
<section id="placebo-cut-offs" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="placebo-cut-offs"><span class="header-section-number">11.2.1</span> Placebo cut-offs</h3>
<p>As we did last week, we can conduct a placebo cut-off test. This test implies looking at the outcome variable but using different cut-offs where we should not expect changes in the outcome. Thus, the estimates from this test should be near zero (and not statistically significant). Again, one <strong>important</strong> step to conduct this test is subsetting the sample for those observations that are above the cut-off and those that are below. We do this to avoid ‘contamination’ due to the real treatment effect. It also ensures that the analysis of each placebo cut-off is conducted using only observations with the same treatment status.</p>
<p>Rather than subsetting the data and creating a new data frame, let’s use the <code>subset</code> argument in the <code>rdrobust()</code> function.</p>
<p><strong>Exercise 13: Conduct a placebo cut-off test using <code>-2.95</code> for the placebo tests below the cut-off. Use the <code>rdrobust()</code> function to perform this test. Set the argument <code>bwselect</code> equal to “mserd”. Replace the cut-off argument <code>c</code> with the value of the placebo cut-off. Add the <code>subset</code> argument and set it equal to <code>data$performance &lt; 0 &amp; data$performance &gt;-3.51.  Use the</code>summary()` command to report the results. What can you conclude based on this test? Does the evidence support the continuity assumption?</strong></p>
<p><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rdrobust</span>(enter<span class="sc">$</span>newsuccess, enter<span class="sc">$</span>performance, <span class="at">c =</span> <span class="sc">-</span><span class="fl">2.95</span>, <span class="at">fuzzy=</span>enter<span class="sc">$</span>treated, <span class="at">cluster=</span>enter<span class="sc">$</span>countrycode,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bwselect=</span><span class="st">"mserd"</span>, <span class="at">subset=</span>enter<span class="sc">$</span>performance <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> enter<span class="sc">$</span>performance <span class="sc">&gt;=</span> <span class="sc">-</span><span class="fl">3.51</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We find that the RD estimate is <code>-0.100</code>, which is pretty small. Also, the robust confidence interval reaches from <code>-17.186</code> to <code>14.109</code>, which clearly includes zero. Thus, this coefficient is not statistically significant. This provides evidence in favour of continuity assumption.</p>
</details>
<p><br>
</p>
</section>
<section id="sorting" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="sorting"><span class="header-section-number">11.2.2</span> Sorting</h3>
<p>As we covered last week, the key identification assumption of RDDs is that there is no <em>sorting</em> on the running variable. That is, the running variable must be continuous around the threshold. We can do this using <em>density checks</em>. This means we’re looking at the density of the running variable. Let’s again use the <code>rddensity</code> package to do so.</p>
<p><strong>Exercise 14: Examine the density of the running variable using the <code>rddensity</code> command. Interpret your findings. See an example of the syntax below: </strong></p>
<p>Doing this is pretty straightforward. You only have to insert the running variable as an argument and, if different from 0, the cut-off. Note that you can optionally specify bandwidths, as above, using the <code>h</code> argument. Otherwise, an optimal bandwidth will be specified automatically. You can then save this as an object and run the <code>summary</code> command to see the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>rdd <span class="ot">&lt;-</span> <span class="fu">rddensity</span>(data<span class="sc">$</span>running_variable, <span class="at">c=</span><span class="dv">0</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rdd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rdd <span class="ot">&lt;-</span> <span class="fu">rddensity</span>(enter<span class="sc">$</span>performance, <span class="at">c=</span><span class="dv">0</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rdd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This test reveals a p-value of <code>0.3239</code>. The null hypothesis of this test is that observations near the cut-off are allocated with a 0.5 probability. Given that we failed to reject the null hypothesis, we can claim there is no evidence of sorting around the cut-off.</p>
</details>
<p><br>
</p>
<p>Let’s now plot this density test like we did last week. Let’s again use the <code>rdplotdensity</code> function. Remember that this function uses the output from the <code>rddensity</code> command. The syntax is simple:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdplotdensity</span>([rdd_object] ,[running_var])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
And these the arguments that you can use.<br>
</p>
<table class="table">
<colgroup>
<col style="width: 56%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th>Argument</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>plotRange</code></td>
<td>Indicates starting and end point of plot</td>
</tr>
<tr class="even">
<td><code>plotN</code></td>
<td>Number of grid points used on either side of the cut-off</td>
</tr>
<tr class="odd">
<td><code>CIuniform</code></td>
<td>True or False. If true, CI are displayed as continuous bands</td>
</tr>
</tbody>
</table>
<p><br>
</p>
<p><strong>Exercise 15: Use the <code>rplotdensity</code> to conduct a visual density check. Set the<code>plotRange</code> function equal to <code>c(-2,2)</code>. Set the <code>plotN</code> argument equal to <code>25</code>. Finally set the <code>CIuniform</code> equal to TRUE.</strong></p>
<p><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plot_rdd <span class="ot">&lt;-</span> <span class="fu">rdplotdensity</span>(rdd, enter<span class="sc">$</span>performance, <span class="at">plotRange =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>), <span class="at">plotN =</span> <span class="dv">25</span>,  <span class="at">CIuniform =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
</p>
<p>Again, we find visual evidence for continuity around the cut-off. Now we can be confident about sorting not being a problem in this data.</p>
<p>You can also conduct the same test using the <code>DCdensity</code> function from the <code>rdd</code> package. Unfortunately, to use this command, you need to drop the observations with missing values. You can use <code>drop_na(running_variable)</code> function to do this.</p>
</details>
<p><br>
</p>
</section>
</section>
<section id="balance" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="balance"><span class="header-section-number">11.3</span> Balance</h2>
<p>Let’s finally conduct a balance test to examine whether near the cut-off treated units are similar to control units in terms of observable characteristics. Ideally, we should get an RD estimate, <span class="math inline">\(\tau_{RD}\)</span>, which is equal to zero.</p>
<p><strong>Exercise 16: Let’s check for balance around the cut-off. Use the <code>rdrobust()</code> function. Set the cut-off argument <code>c</code> equal to 0, and the <code>bwselect</code> argument equal to “mserd”. In this case, the outcome variables are the covariates that we want to check for balance. Check if there is balance for the covariate <code>oldparty</code>, which is the ‘age’ of the party in terms of previously contested elections. Remember to use the <code>summary()</code> command.</strong></p>
<p><br>
</p>
<details>
<summary>
<em>Reveal Answer</em>
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rdrobust</span>(enter<span class="sc">$</span>oldparty, enter<span class="sc">$</span>performance, <span class="at">c=</span><span class="dv">0</span>, <span class="at">bwselect=</span><span class="st">"mserd"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We observe that there is balance for the covariates as it should be.</p>
</details>
<p><br>
</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./rdd.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regression Discontinuity Design</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./summary.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>