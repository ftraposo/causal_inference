<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Causal Inference - 2&nbsp; Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./matching.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./experiments.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Experiments</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Causal Inference</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Potential Outcomes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experiments.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Matching</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Instrumental Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Difference-in-difference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./panel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Panel Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regression Discontinuity Design</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./frdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fuzzy Regression Discontinuity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#details-of-the-experiment" id="toc-details-of-the-experiment" class="nav-link active" data-scroll-target="#details-of-the-experiment"><span class="header-section-number">3</span> Details of the experiment</a></li>
  <li><a href="#non-compliance-in-experiments" id="toc-non-compliance-in-experiments" class="nav-link" data-scroll-target="#non-compliance-in-experiments"><span class="header-section-number">4</span> Non compliance in Experiments</a>
  <ul class="collapse">
  <li><a href="#what-experiment" id="toc-what-experiment" class="nav-link" data-scroll-target="#what-experiment"><span class="header-section-number">4.1</span> What Experiment?</a></li>
  <li><a href="#what-experiment-1" id="toc-what-experiment-1" class="nav-link" data-scroll-target="#what-experiment-1"><span class="header-section-number">4.2</span> What Experiment?</a></li>
  <li><a href="#data-election-observation" id="toc-data-election-observation" class="nav-link" data-scroll-target="#data-election-observation"><span class="header-section-number">4.3</span> 1. Data: Election Observation</a></li>
  <li><a href="#lets-check-this" id="toc-lets-check-this" class="nav-link" data-scroll-target="#lets-check-this"><span class="header-section-number">4.4</span> Let’s check this</a></li>
  <li><a href="#lets-check-this-1" id="toc-lets-check-this-1" class="nav-link" data-scroll-target="#lets-check-this-1"><span class="header-section-number">4.5</span> Let’s check this</a></li>
  <li><a href="#ate-randomization-round-1" id="toc-ate-randomization-round-1" class="nav-link" data-scroll-target="#ate-randomization-round-1"><span class="header-section-number">4.6</span> ATE &amp; Randomization: Round 1</a></li>
  <li><a href="#ate-randomization-round-1-1" id="toc-ate-randomization-round-1-1" class="nav-link" data-scroll-target="#ate-randomization-round-1-1"><span class="header-section-number">4.7</span> ATE &amp; Randomization: Round 1</a></li>
  <li><a href="#round-2" id="toc-round-2" class="nav-link" data-scroll-target="#round-2"><span class="header-section-number">4.8</span> Round 2</a></li>
  <li><a href="#round-2-1" id="toc-round-2-1" class="nav-link" data-scroll-target="#round-2-1"><span class="header-section-number">4.9</span> Round 2</a></li>
  <li><a href="#round-2-2" id="toc-round-2-2" class="nav-link" data-scroll-target="#round-2-2"><span class="header-section-number">4.10</span> Round 2</a></li>
  <li><a href="#non-compliance" id="toc-non-compliance" class="nav-link" data-scroll-target="#non-compliance"><span class="header-section-number">4.11</span> 2. Non-Compliance</a></li>
  <li><a href="#so" id="toc-so" class="nav-link" data-scroll-target="#so"><span class="header-section-number">4.12</span> So?</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Experiments</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">message =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">warning =</span> <span class="cn">TRUE</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>#1. Data: Party Brands Today we are using data from Noam Lupu’s work on <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1540-5907.2012.00615.x"></a> in Argentina. We use it to familiarize ourselves with survey experiments by replicating some of his results.</p>
<p>What we need to know about the paper:</p>
<ul>
<li>Two main theories on the dynamics of partisanship:
<ul>
<li>Partisanship as a social identity (stable)</li>
<li>Partisanship as a rational maximisation expected utility (unstable)</li>
</ul></li>
</ul>
<p>What is Lupu trying to empirically test on this paper?</p>
<ul>
<li>That partisanship as a social identify does not imply necessarily partisan stability</li>
<li>Test his theory that incorporates comparative fit, which means that people think their group differs from other groups</li>
<li>Testable implication: When parties converge, their brands are diluted, thus, it become more difficult for voters to distinguish parties from one another and subsequently party attachments are weaken.</li>
</ul>
<section id="details-of-the-experiment" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Details of the experiment</h1>
<ul>
<li><p>A survey experiment</p></li>
<li><p>Manipulation of information about political parties that suggest either <em>diverge</em> or <em>converge</em> among the parties</p></li>
<li><p>Between-subject design with three-treatment arms, plus a control</p></li>
<li><p>Information was gleaned from party manifestos and official statements</p></li>
<li><p>Control: Party symbols with name of the party leaders</p></li>
<li><p>Outcomes of interest: -<em>Partisanship</em> as the proportion of respondents said they identified with a political party -<em>Partisan attachment</em> on a 0 - 10 scale We load the data, in .csv format, as follows:</p></li>
</ul>
<p>You can use the following shortcuts to insert a r chunk: Ctrl + Alt + I or Cmd + Option + I</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>brands<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">"http://www.spyroskosmidis.net/wp-content/uploads/2018/01/lupubrands.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy version:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>brands_tidy <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(brands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What variables does the data include?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(brands) <span class="co">#Checking first 6 rows of the data </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy version:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(brands_tidy)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>brands_tidy <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Among these variables, let’s focus on the treatment variables and the outcome. There are four variables associated with the treatments and they are captured by the categorical variable<code>formulario</code></p>
<ul>
<li>1 = Control group</li>
<li>2 = Platform Information</li>
<li>3 = Alliance Switching</li>
<li>4 = Full Text</li>
</ul>
<p>This variable is recoded into the dummies <code>frm2=1</code> which takes the value 1 if the respondent received the platform information treatment, <code>frm3=1</code> for alliance switching and <code>frm4=1</code> for the full text. Note the omitted dummy represents the control group.</p>
<p>For now, however, let’s use the original, categorical variable. As it is conventional, we aim to have the control group assigned to value 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>brands<span class="sc">$</span>treat<span class="ot">=</span>brands<span class="sc">$</span>formulario<span class="dv">-1</span>  <span class="co">#Assigning value 0 to the control group</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy version: </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>brands_tidy <span class="ot">&lt;-</span> brands_tidy <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treat =</span> formulario <span class="sc">-</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Did we define the treatment variable correctly? Let’s check again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cbind</span>(brands<span class="sc">$</span>formulario, brands<span class="sc">$</span>treat, brands<span class="sc">$</span>frm2,brands<span class="sc">$</span>frm3,brands<span class="sc">$</span>frm4))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>assignment <span class="ot">&lt;-</span> brands_tidy <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(formulario, treat, frm2, frm3, frm4)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(assignment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Everything looks good! Taking the first row as example, when <code>formulario==3</code> (column1), the treatment variable we generated takes the value 2 (formulario-1) and the dummy for value 3 (frm3) take the value 1, whereas the others are 0.</p>
<p>The Model: OLS Estimations</p>
<p>Lupu is interested in the effect of the three treatment conditions on partisanship. Among the two outcomes, <code>pid</code> (whether the individual identifies with a party) and <code>pidstr</code> (a 10 point scale representing the strength of the respondent’s party identification), we will focus below mainly on the latter.</p>
<p>#3.Let’s beging with a simple OLS model with no covariates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(pidstr<span class="sc">~</span>treat, <span class="at">data=</span>brands))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy version: </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>lin_fit <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(pidstr <span class="sc">~</span> treat, <span class="at">data =</span> brands_tidy)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lin_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Does this regression make sense? Hint: <code>class(brands$treat)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's assign labels to each group. This will help with the output!</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>brands<span class="sc">$</span>treat[brands<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">0</span>]<span class="ot">=</span><span class="st">"Control"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>brands<span class="sc">$</span>treat[brands<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">1</span>]<span class="ot">=</span><span class="st">"Platform"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>brands<span class="sc">$</span>treat[brands<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">2</span>]<span class="ot">=</span><span class="st">"Switch"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>brands<span class="sc">$</span>treat[brands<span class="sc">$</span>treat<span class="sc">==</span><span class="dv">3</span>]<span class="ot">=</span><span class="st">"Full"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy version:</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>brands_tidy <span class="ot">&lt;-</span> brands_tidy <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treat =</span> <span class="fu">recode</span>(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    treat,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Control"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Platform"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Switch"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Full"</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Re-running the regression from above and telling R to model treat as a factor variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(pidstr<span class="sc">~</span><span class="fu">factor</span>(treat), <span class="at">data=</span>brands))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy version: </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>lin_fit <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(pidstr <span class="sc">~</span> <span class="fu">factor</span>(treat), <span class="at">data =</span> brands_tidy)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lin_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The OLS regression results look like mere mean differences. Let’s see if that is true:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pid.control<span class="ot">=</span><span class="fu">mean</span>(brands<span class="sc">$</span>pidstr[brands<span class="sc">$</span>treat<span class="sc">==</span><span class="st">"Control"</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pid.platform<span class="ot">=</span><span class="fu">mean</span>(brands<span class="sc">$</span>pidstr[brands<span class="sc">$</span>treat<span class="sc">==</span><span class="st">"Platform"</span>],<span class="at">na.rm=</span>T)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>pid.switch<span class="ot">=</span><span class="fu">mean</span>(brands<span class="sc">$</span>pidstr[brands<span class="sc">$</span>treat<span class="sc">==</span><span class="st">"Switch"</span>],<span class="at">na.rm=</span>T)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>pid.full<span class="ot">=</span><span class="fu">mean</span>(brands<span class="sc">$</span>pidstr[brands<span class="sc">$</span>treat<span class="sc">==</span><span class="st">"Full"</span>],<span class="at">na.rm=</span>T)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ate.platform<span class="ot">=</span>pid.platform<span class="sc">-</span>pid.control</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>ate.switch<span class="ot">=</span> pid.switch<span class="sc">-</span>pid.control</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>ate.full<span class="ot">=</span>pid.full<span class="sc">-</span>pid.control</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy version:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>pid.control <span class="ot">&lt;-</span> brands_tidy <span class="sc">%&gt;%</span> <span class="co"># E_Y_X_control</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat <span class="sc">==</span> <span class="st">"Control"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">conditional_mean =</span> <span class="fu">mean</span>(pidstr, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>pid.platform <span class="ot">&lt;-</span> brands_tidy <span class="sc">%&gt;%</span> <span class="co"># E_Y_X_platform</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat <span class="sc">==</span> <span class="st">"Platform"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">conditional_mean =</span> <span class="fu">mean</span>(pidstr, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>pid.switch <span class="ot">&lt;-</span> brands_tidy <span class="sc">%&gt;%</span> <span class="co"># E_Y_X_switch</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat <span class="sc">==</span> <span class="st">"Switch"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">conditional_mean =</span> <span class="fu">mean</span>(pidstr, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>pid.switch <span class="ot">&lt;-</span> brands_tidy <span class="sc">%&gt;%</span> <span class="co"># E_Y_X_1_full</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat <span class="sc">==</span> <span class="st">"Full"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">conditional_mean =</span> <span class="fu">mean</span>(pidstr, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>ate.platform<span class="ot">=</span>pid.platform<span class="sc">-</span>pid.control</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>ate.switch<span class="ot">=</span> pid.switch<span class="sc">-</span>pid.control</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>ate.full<span class="ot">=</span>pid.full<span class="sc">-</span>pid.control</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>ate.platform</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>ate.switch</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>ate.full</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The ATEs we calculated just now are identical to the OLS slopes we calculated before. So, why do OLS?</p>
<p>Firstly, we prefer models that can calculate measures of dispersion for the estimates. In other words, through substracting the means by treatment group we would not be able to know whether the ATEs are statistically significant. Secondly, the advantage of using OLS is that we can include -pre-treatment- covariates.</p>
<p>Still, can you think of other ways to estimate statistical uncertainty without using OLS?</p>
<p>Let’s see what happens when we add covariates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(pidstr<span class="sc">~</span><span class="fu">factor</span>(treat)<span class="sc">+</span>age<span class="sc">+</span>income<span class="sc">+</span>educgrp<span class="sc">+</span>info, <span class="at">data=</span>brands))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Are the results the same?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Re-estimate the main model</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>atemod<span class="ot">=</span><span class="fu">lm</span>(pidstr<span class="sc">~</span><span class="fu">factor</span>(treat), <span class="at">data=</span>brands)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(atemod)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nobs</span>(atemod)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Add covariates</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>atemodcont<span class="ot">=</span><span class="fu">lm</span>(pidstr<span class="sc">~</span><span class="fu">factor</span>(treat)<span class="sc">+</span>age<span class="sc">+</span>income<span class="sc">+</span>educgrp<span class="sc">+</span>info, <span class="at">data=</span>brands)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(atemodcont)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">nobs</span>(atemodcont)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Why do we lose so many observations? Is this is a fair comparison of the ATE?</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's constrain the estimation to the N of the model with the added covariates</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>esample<span class="ot">=</span><span class="fu">rownames</span>(<span class="fu">as.matrix</span>(<span class="fu">resid</span>(atemodcont)))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>atemodsample<span class="ot">=</span><span class="fu">lm</span>(pidstr<span class="sc">~</span><span class="fu">factor</span>(treat), <span class="at">data=</span>brands[esample,])</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(atemodsample)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">nobs</span>(atemodsample)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("stargazer")</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(atemodcont, atemodsample,  <span class="at">type =</span> <span class="st">"text"</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># sort of a tidy version:</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>constrain <span class="ot">&lt;-</span> brands_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row.names</span>(brands_tidy) <span class="sc">%in%</span> esample) </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>atemodsample<span class="ot">=</span><span class="fu">lm</span>(pidstr<span class="sc">~</span><span class="fu">factor</span>(treat), <span class="at">data=</span>constrain)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(atemodsample)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="fu">nobs</span>(atemodsample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Randomization Checks</em></p>
<p>Let’s do some randomization checks. Is the mean value of age similar across treatment groups?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(brands<span class="sc">$</span>age<span class="sc">~</span>brands<span class="sc">$</span>frm2, <span class="at">data=</span>brands, <span class="at">subset=</span><span class="fu">c</span>(brands<span class="sc">$</span>frm3<span class="sc">!=</span><span class="dv">1</span>,brands<span class="sc">$</span>frm4<span class="sc">!=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#and, similarly, for the other treatments</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(brands<span class="sc">$</span>age<span class="sc">~</span>brands<span class="sc">$</span>frm3, <span class="at">data=</span>brands, <span class="at">subset=</span><span class="fu">c</span>(brands<span class="sc">$</span>frm2<span class="sc">!=</span><span class="dv">1</span>,brands<span class="sc">$</span>frm4<span class="sc">!=</span><span class="dv">1</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(brands<span class="sc">$</span>age<span class="sc">~</span>brands<span class="sc">$</span>frm4, <span class="at">data=</span>brands, <span class="at">subset=</span><span class="fu">c</span>(brands<span class="sc">$</span>frm3<span class="sc">!=</span><span class="dv">1</span>,brands<span class="sc">$</span>frm2<span class="sc">!=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How about income?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(brands<span class="sc">$</span>income<span class="sc">~</span>brands<span class="sc">$</span>frm2, <span class="at">data=</span>brands, <span class="at">subset=</span><span class="fu">c</span>(brands<span class="sc">$</span>frm3<span class="sc">!=</span><span class="dv">1</span>,brands<span class="sc">$</span>frm4<span class="sc">!=</span><span class="dv">1</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(brands<span class="sc">$</span>income<span class="sc">~</span>brands<span class="sc">$</span>frm3, <span class="at">data=</span>brands, <span class="at">subset=</span><span class="fu">c</span>(brands<span class="sc">$</span>frm2<span class="sc">!=</span><span class="dv">1</span>,brands<span class="sc">$</span>frm4<span class="sc">!=</span><span class="dv">1</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(brands<span class="sc">$</span>income<span class="sc">~</span>brands<span class="sc">$</span>frm4, <span class="at">data=</span>brands, <span class="at">subset=</span><span class="fu">c</span>(brands<span class="sc">$</span>frm3<span class="sc">!=</span><span class="dv">1</span>,brands<span class="sc">$</span>frm2<span class="sc">!=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or gender?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(brands<span class="sc">$</span>frm2,brands<span class="sc">$</span>female[brands<span class="sc">$</span>treat<span class="sc">!=</span><span class="dv">3</span> <span class="sc">&amp;</span> brands<span class="sc">$</span>treat<span class="sc">!=</span><span class="dv">2</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="fu">table</span>(brands<span class="sc">$</span>frm2,brands<span class="sc">$</span>female[brands<span class="sc">$</span>treat<span class="sc">!=</span><span class="dv">3</span> <span class="sc">&amp;</span> brands<span class="sc">$</span>treat<span class="sc">!=</span><span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="fu">table</span>(brands<span class="sc">$</span>frm3,brands<span class="sc">$</span>female[brands<span class="sc">$</span>treat<span class="sc">!=</span><span class="dv">3</span> <span class="sc">&amp;</span> brands<span class="sc">$</span>treat<span class="sc">!=</span><span class="dv">1</span>]))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="fu">table</span>(brands<span class="sc">$</span>frm4,brands<span class="sc">$</span>female[brands<span class="sc">$</span>treat<span class="sc">!=</span><span class="dv">3</span> <span class="sc">&amp;</span> brands<span class="sc">$</span>treat<span class="sc">!=</span><span class="dv">2</span>]))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy version - need to double check: </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>brands_tidy <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat <span class="sc">==</span>  <span class="fu">c</span>(<span class="st">"Switch"</span>, <span class="st">"Control"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(frm4, female) <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cases =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop =</span> <span class="fu">sum</span>(cases)) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tst =</span> <span class="fu">list</span>(broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">prop.test</span>(</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    cases, pop, <span class="at">conf.level =</span> <span class="fl">0.95</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  )))) <span class="sc">%&gt;%</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(tst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An equivalent to a ttest is the kolomogorov smirnov test that compares distributions (only works for continuous variables)</p>
<p><span class="math display">\[
D = \max_{1 \leq i \leq N} (F(Y_i) - \frac{i - 1}{N}, \frac{i}{N} - F(Y_i))
\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="KS_Example.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Cummulative distribution functions</figcaption>
</figure>
</div>
</section>
<section id="non-compliance-in-experiments" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Non compliance in Experiments</h1>
<section id="what-experiment" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="what-experiment"><span class="header-section-number">4.1</span> What Experiment?</h2>
<p>You already know various types of experiments, such as survey experiments, lab experiments, field experiments.</p>
<p>How do natural experiments fit in?</p>
</section>
<section id="what-experiment-1" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="what-experiment-1"><span class="header-section-number">4.2</span> What Experiment?</h2>
<p>You already know various types of experiments, such as survey experiments, lab experiments, field experiments.</p>
<p>How do natural experiments fit in?</p>
<ul>
<li>IR: Rotating Presidency of the Council of the EU (Carnegie/Marinov 2017)</li>
<li>CP: Population size &amp; electoral system (Eggers 2015)</li>
<li>many others…</li>
<li>IR/CP: Election Observation (Hyde 2007)</li>
</ul>
</section>
<section id="data-election-observation" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="data-election-observation"><span class="header-section-number">4.3</span> 1. Data: Election Observation</h2>
<p>Today we are using data from Susan Hyde’s work on <a href="https://heinonline.org/HOL/LandingPage?handle=hein.journals/wpot60&amp;div=6&amp;id=&amp;page"><strong>the observer effect in international politics</strong></a> in Armenia.</p>
<ul>
<li><p>Research Question: <em>Do international monitoring missions have an effect on electoral outcomes?</em></p></li>
<li><p>Hyde’s reasoning: Cross-sectional comparisons are not suitable as there will be endogeneity</p></li>
<li><p>Hyde’s solution: Moving to the microlevel! (What effect do observers have on election-day fraud?)</p>
<ul>
<li>2003 Presidential elections in Armenia</li>
</ul></li>
<li><p>The Experiment: Analysing observed and unobserved polling stations, relying on OSCE missions in terms of incumbent’s vote share</p></li>
<li><p>Outcome: Hyde concludes there was a <strong>5.9%</strong> difference in first round and a <strong>2%</strong> difference in the second round (simple differences in means).</p></li>
</ul>
</section>
<section id="lets-check-this" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="lets-check-this"><span class="header-section-number">4.4</span> Let’s check this</h2>
<ul>
<li>Do we buy that?</li>
</ul>
<p>What might be the problems associated with this natural experiment?</p>
</section>
<section id="lets-check-this-1" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="lets-check-this-1"><span class="header-section-number">4.5</span> Let’s check this</h2>
<p>First, as always, we load the file (this time from Stata)…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readstata13)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>hyde2007 <span class="ot">&lt;-</span> <span class="fu">read.dta13</span>(<span class="at">file =</span> <span class="st">'/cloud/project/hyde2007_uploadR.dta'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>…and look at the data, that is at some variables of interest:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cbind</span>(hyde2007<span class="sc">$</span>pollingstation, hyde2007<span class="sc">$</span>urban, hyde2007<span class="sc">$</span>voterspersqkm, hyde2007<span class="sc">$</span>kocharian, hyde2007<span class="sc">$</span>mon_voting, hyde2007<span class="sc">$</span>mon_voting_R2, hyde2007<span class="sc">$</span>KocharianR2, hyde2007<span class="sc">$</span>osce_assignment))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Exercise</strong>: For the first round results, (i) calculate the difference in means of the incumbent’s vote share (<code>kocharian</code>) between observed and unobserved polling stations and (ii) find out whether randomization worked regarding the rural-urban divide (<code>urban</code>).</p>
</section>
<section id="ate-randomization-round-1" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="ate-randomization-round-1"><span class="header-section-number">4.6</span> ATE &amp; Randomization: Round 1</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(hyde2007<span class="sc">$</span>kocharian[hyde2007<span class="sc">$</span>mon_voting<span class="sc">==</span><span class="dv">1</span>], <span class="at">na.rm=</span>T, <span class="at">from=</span><span class="fu">min</span>(<span class="dv">0</span>, <span class="at">na.rm=</span>T), <span class="at">to=</span><span class="fu">max</span>(<span class="dv">1</span>, <span class="at">na.rm=</span>T)))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(hyde2007<span class="sc">$</span>kocharian[hyde2007<span class="sc">$</span>mon_voting<span class="sc">==</span><span class="dv">0</span>], <span class="at">na.rm=</span>T, <span class="at">from=</span><span class="fu">min</span>(<span class="dv">0</span>, <span class="at">na.rm=</span>T), <span class="at">to=</span><span class="fu">max</span>(<span class="dv">1</span>, <span class="at">na.rm=</span>T)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ate-randomization-round-1-1" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="ate-randomization-round-1-1"><span class="header-section-number">4.7</span> ATE &amp; Randomization: Round 1</h2>
<p>To calculate the difference in means, we could use</p>
<ul>
<li>a t.test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(hyde2007<span class="sc">$</span>kocharian <span class="sc">~</span> hyde2007<span class="sc">$</span>mon_voting)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>an OLS regression</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ols1<span class="ot">=</span><span class="fu">lm</span>(kocharian <span class="sc">~</span> mon_voting, <span class="at">data=</span>hyde2007)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can do the same (using a prop.test instead of a t.test) in order to check whether randomization worked.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="fu">table</span>(hyde2007<span class="sc">$</span>urban, hyde2007<span class="sc">$</span>mon_voting))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ols_urban<span class="ot">=</span><span class="fu">lm</span>(urban <span class="sc">~</span> mon_voting, <span class="at">data=</span>hyde2007)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols_urban)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What do we conclude? Do we have reason to think this might affect the validity of the results?</p>
</section>
<section id="round-2" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="round-2"><span class="header-section-number">4.8</span> Round 2</h2>
<p>Let’s quickly do the same for Round 2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ols2<span class="ot">=</span><span class="fu">lm</span>(KocharianR2 <span class="sc">~</span> mon_voting_R2, <span class="at">data=</span>hyde2007)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This looks like a somewhat weaker effect of the observers…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ols2_urban<span class="ot">=</span><span class="fu">lm</span>(urban <span class="sc">~</span> mon_voting_R2, <span class="at">data=</span>hyde2007)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols2_urban)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Round 2 seems to be even less balanced in terms of the representation of urban and rural polling stations.</p>
<ul>
<li>What else could be relevant in Round 2? Why should we account for this?</li>
</ul>
</section>
<section id="round-2-1" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="round-2-1"><span class="header-section-number">4.9</span> Round 2</h2>
<ul>
<li>Hyde concludes that her <em>“results suggest that if first-round monitoring took place then second-round monitoring had only a marginal additional deterrent effect.”</em> (p.56). She claims that first-round observation has a persistant effect.</li>
<li>Your thoughts on this?</li>
</ul>
</section>
<section id="round-2-2" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="round-2-2"><span class="header-section-number">4.10</span> Round 2</h2>
<ul>
<li>Hyde concludes that her <em>“results suggest that if first-round monitoring took place then second-round monitoring had only a marginal additional deterrent effect.”</em> (p.56). She claims that first-round observation has a persistant effect.</li>
<li>Your thoughts on this?</li>
</ul>
<p>Let’s see whether monitoring in the two rounds was independent. First, we check the number of polling stations observed per round.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">with</span>(hyde2007, mon_voting<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> mon_voting_R2<span class="sc">==</span><span class="dv">0</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">with</span>(hyde2007, mon_voting<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> mon_voting_R2<span class="sc">==</span><span class="dv">0</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">with</span>(hyde2007, mon_voting<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> mon_voting_R2<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">with</span>(hyde2007, mon_voting<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> mon_voting_R2<span class="sc">==</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Well, in Round 2 more stations were observed that had been monitored in Round 1 than those that had not been monitored. Let’s confirm significance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="fu">table</span>(hyde2007<span class="sc">$</span>mon_voting_R2, hyde2007<span class="sc">$</span>mon_voting))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>ols2_full<span class="ot">=</span><span class="fu">lm</span>(mon_voting_R2 <span class="sc">~</span> urban <span class="sc">+</span> mon_voting, <span class="at">data=</span>hyde2007)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols2_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What do we conclude?</p>
<ul>
<li>Round 2 monitoring was not randomized either.</li>
<li>If we apply experimental standards (which is what we should do), we conclude that Round 2 monitoring was not independent from Round 1 monitoring.</li>
</ul>
</section>
<section id="non-compliance" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="non-compliance"><span class="header-section-number">4.11</span> 2. Non-Compliance</h2>
<p>One of the reasons for the imbalance between rural and urban polling station could be that observers did not adhere to their assigned polling stations. Let’s now assume, the OSCE did a good job and assigned polling stations randomly (<code>osce_assignment</code>).</p>
<p>In that case, one-sided <strong>non-compliance</strong> would be a problem. Polling stations that were supposed to be monitored were, in fact, not monitored on election day. Let’s check Hyde’s results once we consider non-compliance to be a problem</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(hyde2007) <span class="co"># it helps to avoid using the dollar sign</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s start with a (some naive) simple differences in means:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#As-treated Analysis</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mean</span>(KocharianR2[mon_voting_R2<span class="sc">==</span><span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">mean</span>(KocharianR2[mon_voting_R2<span class="sc">==</span><span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>hyde2007 <span class="ot">&lt;-</span> hyde2007 <span class="sc">%&gt;%</span>  <span class="co"># remove any NAs</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(KocharianR2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at a simple crosstab, showing assigned treatment and actual treatment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Compliance Status - Binary</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>tab<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">table</span>(osce_assignment, mon_voting_R2)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tab<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we calculate the <code>ITT.y</code>. We can do this using differences in means or simply running an OLS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ITT_Y</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>itt.y <span class="ot">&lt;-</span> (<span class="fu">mean</span>(KocharianR2[osce_assignment<span class="sc">==</span><span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">mean</span>(KocharianR2[osce_assignment<span class="sc">==</span><span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>itt.y </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ITT_Y using OLS</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>itt_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(KocharianR2 <span class="sc">~</span> osce_assignment)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(itt_fit)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#coeftest(itt_fit, vcovHC(itt_fit))  # Heteroscedasticity-Consistent Covariance Matrix Estimation-Consistent Covariance </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Accordingly, we calculate the ITT.d</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ITT_D</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>itt.d <span class="ot">&lt;-</span> (<span class="fu">mean</span>(mon_voting_R2[osce_assignment<span class="sc">==</span><span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">mean</span>(mon_voting_R2[osce_assignment<span class="sc">==</span><span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>itt.d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ITT_D using OLS </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>itt_d_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(mon_voting_R2 <span class="sc">~</span> osce_assignment)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(itt_d_fit)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># coeftest(itt_d_fit, vcovHC(itt_d_fit)) # Heteroscedasticity-Consistent Covariance Matrix Estimation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s quickly have a look at the compliance status and the broad picture.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's remember the compliance status [1] 883 [2]258 [3] 0 [4]623</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>tab<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">table</span>(osce_assignment, mon_voting_R2)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tab<span class="fl">.1</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Always-Takers  </span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Under one-sided non-compliance there are no Always takers, so this should be zero</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 / (883 + 0) = 0 </span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>at <span class="ot">&lt;-</span> tab<span class="fl">.1</span>[<span class="dv">3</span>]<span class="sc">/</span>(tab<span class="fl">.1</span>[<span class="dv">1</span>] <span class="sc">+</span> tab<span class="fl">.1</span>[<span class="dv">3</span>])  </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>at</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Never Takers</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 258/(258 + 623) = 0.29</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This means that from those polling stations that were assigned to treatment, 29% will not be monitored</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>nt <span class="ot">&lt;-</span> tab<span class="fl">.1</span>[<span class="dv">2</span>]<span class="sc">/</span>(tab<span class="fl">.1</span>[<span class="dv">2</span>] <span class="sc">+</span> tab<span class="fl">.1</span>[<span class="dv">4</span>])</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>nt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Compliers (No Defiers By Assumption)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> at <span class="sc">-</span> nt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, using the <code>ITT.y</code> and the <code>ITT.d</code> , we can calculate the CACE:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#CACE: ITT_Y divided by ITT_D # COMPLIER AVERAGE CAUSAL EFFECT</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mean</span>(KocharianR2[osce_assignment<span class="sc">==</span><span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">mean</span>(KocharianR2[osce_assignment<span class="sc">==</span><span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">/</span>(<span class="fu">mean</span>(mon_voting_R2[osce_assignment<span class="sc">==</span><span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">mean</span>(mon_voting_R2[osce_assignment<span class="sc">==</span><span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>cace <span class="ot">&lt;-</span> itt.y<span class="sc">/</span>itt.d <span class="co"># This should be the same! </span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also calculate the significance of the CACE. To do so, we calculate the standard errors of the CACE (this is in fact, an approximation):</p>
<p><code>SE(CACE) ≈ SE(ITT.Y) / ITT.D</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>se_cace <span class="ot">&lt;-</span> <span class="fu">summary</span>(itt_fit)<span class="sc">$</span>coefficients[<span class="dv">4</span>]<span class="sc">/</span>itt_d_fit<span class="sc">$</span>coefficients </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(se_cace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then calculate the p-value as we did last week:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>t_cace <span class="ot">&lt;-</span> cace <span class="sc">/</span> se_cace</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t_cace)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(t_cace), <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we will be seeing in a few weeks time, we can also use 2SLS regressions to calculate the CACE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Via TSLS</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">ivreg</span>(KocharianR2 <span class="sc">~</span> mon_voting_R2<span class="sc">|</span>osce_assignment, <span class="at">data=</span>hyde2007))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="so" class="level2" data-number="4.12">
<h2 data-number="4.12" class="anchored" data-anchor-id="so"><span class="header-section-number">4.12</span> So?</h2>
<ul>
<li><p>What do we make of Susan Hyde’s paper?</p></li>
<li><p>Is this a “bad” experiment? Why?</p></li>
<li><p>Can there be “perfect” natural experiments?</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Potential Outcomes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./matching.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Matching</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>